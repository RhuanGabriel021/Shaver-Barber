<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>Admin | Shaver Barber</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- BOOTSTRAP -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- BOOTSTRAP ICONS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <!-- FONTES -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-dark: #020617;
      --bg-dark-alt: #050816;
      --accent: #00ff57;
      --accent-soft: #26ff7a;
      --text-main: #f9fafb;
      --text-soft: #e5e7eb;
      --card-bg: rgba(15,23,42,0.98);
      --border-soft: rgba(148,163,184,0.2);
      --danger: #ef4444;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      min-height: 100vh;
      background:
        radial-gradient(circle at top, rgba(0,255,87,0.22) 0, transparent 55%),
        radial-gradient(circle at bottom, rgba(0,255,87,0.18) 0, transparent 55%),
        linear-gradient(145deg, var(--bg-dark-alt), #000);
      color: var(--text-main);
    }

    .admin-page {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* TOPO */
    .topo-admin {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      border-bottom: 1px solid rgba(148,163,184,0.25);
      background: radial-gradient(circle at top left, rgba(0,255,87,0.12), transparent 40%),
                  rgba(2,6,23,0.96);
      backdrop-filter: blur(10px);
    }

    .topo-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .topo-logo {
      width: 38px;
      height: 38px;
      object-fit: contain;
      filter: drop-shadow(0 0 12px rgba(0,255,87,0.45));
    }

    .topo-title {
      display: flex;
      flex-direction: column;
      line-height: 1.2;
    }

    .topo-title span.app-name {
      font-family: 'Oswald', sans-serif;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      font-size: 0.85rem;
    }

    .topo-title span.app-name strong {
      color: var(--accent);
      text-shadow: 0 0 10px rgba(0,255,87,0.6);
    }

    .topo-title span.section {
      font-size: 0.75rem;
      color: var(--text-soft);
    }

    .topo-right {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .admin-info {
      text-align: right;
      font-size: 0.76rem;
      color: var(--text-soft);
    }

    .admin-info strong {
      color: var(--accent-soft);
    }

    .btn-sair {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.4);
      background: transparent;
      color: var(--text-soft);
      font-size: 0.8rem;
      padding: 6px 14px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-sair:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    main {
      flex: 1;
      padding: 16px;
    }

    .grid-main {
      display: grid;
      gap: 16px;
    }

    @media (min-width: 992px) {
      .grid-main {
        grid-template-columns: 2fr 1.4fr;
      }
    }

    .card-section {
      background: var(--card-bg);
      border-radius: 18px;
      border: 1px solid var(--border-soft);
      padding: 16px 14px 14px;
      box-shadow: 0 18px 40px rgba(0,0,0,0.55);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .card-title {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.96rem;
      font-weight: 500;
    }

    .card-title i {
      font-size: 1.1rem;
    }

    .card-subtitle {
      font-size: 0.78rem;
      color: var(--text-soft);
      margin-bottom: 8px;
    }

    /* KPIs financeiros */
    .kpis-grid {
      display: grid;
      gap: 10px;
      margin-top: 4px;
    }

    @media (min-width: 768px) {
      .kpis-grid {
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }
    }

    .kpi-card {
      border-radius: 12px;
      border: 1px solid rgba(148,163,184,0.4);
      padding: 8px 10px;
      background: rgba(15,23,42,0.96);
      font-size: 0.8rem;
    }

    .kpi-label {
      font-size: 0.75rem;
      color: var(--text-soft);
      margin-bottom: 2px;
    }

    .kpi-value {
      font-size: 0.95rem;
      font-weight: 600;
      color: var(--accent-soft);
    }

    .kpi-extra {
      font-size: 0.7rem;
      color: var(--text-soft);
      margin-top: 2px;
    }

    .kpi-variacao {
      font-size: 0.8rem;
      font-weight: 500;
    }

    .kpi-variacao.up {
      color: #22c55e;
    }

    .kpi-variacao.down {
      color: #ef4444;
    }

    /* Entradas x saídas */
    .resumo-financeiro-linhas {
      font-size: 0.8rem;
      margin-top: 6px;
    }

    .resumo-financeiro-linhas .linha {
      display: flex;
      justify-content: space-between;
      margin-bottom: 2px;
    }

    .resumo-financeiro-linhas .linha strong {
      font-weight: 600;
    }

    .linha-saldo strong {
      color: var(--accent-soft);
    }

    /* Tabela de registros */
    .table-finance {
      width: 100%;
      font-size: 0.78rem;
      color: var(--text-main);
    }

    .table-finance thead {
      font-size: 0.76rem;
      color: var(--text-soft);
      border-bottom: 1px solid rgba(148,163,184,0.4);
    }

    .table-finance tbody tr {
      border-bottom: 1px solid rgba(30,41,59,0.8);
    }

    .table-finance tbody tr:last-child {
      border-bottom: none;
    }

    .table-finance td, .table-finance th {
      padding: 6px 4px;
    }

    .badge-mes {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.5);
      padding: 2px 8px;
      font-size: 0.7rem;
      color: var(--text-soft);
    }

    /* Gestão de barbeiros */
    .barbeiros-lista {
      max-height: 260px;
      overflow-y: auto;
      margin-top: 4px;
    }

    .barbeiro-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      border-radius: 10px;
      border: 1px solid rgba(148,163,184,0.4);
      background: rgba(15,23,42,0.96);
      padding: 7px 9px;
      font-size: 0.8rem;
      margin-bottom: 6px;
    }

    .barbeiro-info {
      display: flex;
      flex-direction: column;
    }

    .barbeiro-nome {
      font-weight: 500;
      color: var(--text-main);
    }

    .barbeiro-extra {
      font-size: 0.72rem;
      color: var(--text-soft);
    }

    .status-pill {
      border-radius: 999px;
      padding: 2px 8px;
      font-size: 0.7rem;
      border: 1px solid rgba(148,163,184,0.6);
      margin-right: 6px;
    }

    .status-ativo {
      color: #22c55e;
      border-color: rgba(34,197,94,0.8);
    }

    .status-bloqueado {
      color: #ef4444;
      border-color: rgba(239,68,68,0.8);
    }

    .btn-toggle {
      border-radius: 999px;
      border: none;
      font-size: 0.74rem;
      padding: 4px 10px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .btn-toggle.ativar {
      background: var(--accent);
      color: #000;
    }

    .btn-toggle.bloquear {
      background: rgba(15,23,42,0.96);
      color: #f97316;
      border: 1px solid rgba(249,115,22,0.7);
    }

    /* Form novo barbeiro */
    .form-label-sm {
      font-size: 0.75rem;
      color: var(--text-soft);
    }

    .form-control-dark, .form-select-dark {
      background-color: #020617;
      border: 1px solid #1f2937;
      color: var(--text-main);
      font-size: 0.8rem;
      padding: 6px 8px;
      border-radius: 10px;
    }

    .form-control-dark:focus, .form-select-dark:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 0.12rem rgba(0,255,87,0.25);
      background-color: #020617;
      color: var(--text-main);
    }

    .btn-salvar-barbeiro {
      background: var(--accent);
      color: #000;
      border-radius: 999px;
      border: none;
      font-size: 0.8rem;
      font-weight: 600;
      padding: 6px 12px;
      margin-top: 4px;
    }

    .helper-text {
      font-size: 0.7rem;
      color: var(--text-soft);
      margin-top: 2px;
    }

    .filter-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      margin-bottom: 6px;
      font-size: 0.78rem;
    }

    .filter-row span {
      color: var(--text-soft);
    }
  </style>
</head>

<body>
<div class="admin-page">

  <!-- TOPO -->
  <header class="topo-admin">
    <div class="topo-left">
      <img src="shavv.png" alt="Logo Shaver Barber" class="topo-logo">
      <div class="topo-title">
        <span class="app-name"><strong>Shaver</strong> Barber</span>
      </div>
    </div>
    <div class="topo-right">
      <div class="admin-info">
        <div>Logado como</div>
        <div><strong>Jeff</strong></div>
      </div>
      <button class="btn-sair" onclick="window.location.href='login.html'">
        <i class="bi bi-box-arrow-right"></i> Sair
      </button>
    </div>
  </header>

  <!-- CONTEÚDO -->
  <main>
    <div class="grid-main">

      <!-- COLUNA ESQUERDA: Financeiro -->
      <section class="card-section">
        <div class="card-header">
          <div class="card-title">
            <i class="bi bi-graph-up-arrow"></i>
            <span>Visão financeira da barbearia</span>
          </div>
        </div>
        <p class="card-subtitle">
          Relatório mensal com entrada total, saídas estimadas (repasse + custo de produtos) e comparação com o mês anterior.
          (Simulação baseada nos registros finalizados pelos barbeiros.)
        </p>

        <div class="filter-row">
          <span>Mês atual:</span>
          <span id="labelMesAtual" class="badge-mes">--/----</span>
          <span>Mês anterior:</span>
          <span id="labelMesAnterior" class="badge-mes">--/----</span>
        </div>

        <!-- KPIs principais -->
        <div class="kpis-grid">
          <div class="kpi-card">
            <div class="kpi-label">Entrada total (mês atual)</div>
            <div id="kpiEntradaAtual" class="kpi-value">R$ 0,00</div>
            <div class="kpi-extra">Serviços + consumos já quitados.</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-label">Entrada total (mês anterior)</div>
            <div id="kpiEntradaAnterior" class="kpi-value">R$ 0,00</div>
            <div class="kpi-extra">Baseado nos registros do mês anterior.</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-label">Variação vs mês anterior</div>
            <div id="kpiVariacao" class="kpi-variacao">--</div>
            <div class="kpi-extra">Mostra crescimento ou queda percentual.</div>
          </div>
        </div>

        <!-- Entradas x saídas -->
        <div class="resumo-financeiro-linhas mt-3">
          <div class="linha">
            <span>Entradas (mês atual)</span>
            <strong id="linhaEntradas">R$ 0,00</strong>
          </div>
          <div class="linha">
            <span>Saídas estimadas</span>
            <span style="font-size:0.74rem; color:var(--text-soft);">
              (repasse barbeiros + custo produtos)
            </span>
            <strong id="linhaSaidas">R$ 0,00</strong>
          </div>
          <div class="linha linha-saldo">
            <span>Saldo estimado da barbearia</span>
            <strong id="linhaSaldo">R$ 0,00</strong>
          </div>
        </div>

        <p class="helper-text mt-2">
          Para simplificar a atividade: repasse dos barbeiros considerado em 50% do faturamento bruto
          e custo dos produtos estimado em 40% da parte de consumos.
        </p>

        <!-- Tabela de registros -->
        <div class="card-header mt-3">
          <div class="card-title">
            <i class="bi bi-journal-text"></i>
            <span>Registros financeiros do mês atual</span>
          </div>
        </div>
        <p class="card-subtitle">
          Cada linha representa o fechamento de um cliente (serviço + consumos) finalizado pelo barbeiro.
        </p>

        <div class="table-responsive" style="max-height:260px; overflow-y:auto;">
          <table class="table-finance">
            <thead>
              <tr>
                <th>Data</th>
                <th>Cliente</th>
                <th>Serviços</th>
                <th>Consumos</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody id="tabelaRegistrosBody">
              <!-- preenchido via JS -->
            </tbody>
          </table>
        </div>
      </section>

      <!-- COLUNA DIREITA: Barbeiros -->
      <section class="card-section">
        <!-- Gestão barbeiros -->
        <div class="card-header">
          <div class="card-title">
            <i class="bi bi-people-fill"></i>
            <span>Barbeiros da barbearia</span>
          </div>
        </div>
        <p class="card-subtitle">
          Ative, bloqueie e cadastre barbeiros. Essas ações, em um sistema real, controlariam o acesso ao app.
          Aqui são simulações para a atividade.
        </p>

        <div id="listaBarbeiros" class="barbeiros-lista">
          <!-- preenchido via JS -->
        </div>

        <!-- Cadastro de novo barbeiro -->
        <div class="card-header mt-3">
          <div class="card-title">
            <i class="bi bi-person-plus"></i>
            <span>Registrar novo barbeiro</span>
          </div>
        </div>
        <p class="card-subtitle">
          Cadastro rápido. A porcentagem de comissão é usada apenas para exibição neste painel.
        </p>

        <form id="formNovoBarbeiro">
          <div class="mb-1">
            <label class="form-label-sm">Nome completo</label>
            <input type="text" id="novoNome" class="form-control-dark w-100" placeholder="Ex.: João Santos" required>
          </div>
          <div class="mb-1">
            <label class="form-label-sm">Apelido / nome no app</label>
            <input type="text" id="novoApelido" class="form-control-dark w-100" placeholder="Ex.: João" required>
          </div>
          <div class="mb-1">
            <label class="form-label-sm">Porcentagem de comissão (%)</label>
            <input type="number" id="novaComissao" class="form-control-dark w-100" min="0" max="100" step="5" value="50">
          </div>
          <div class="mb-2">
            <label class="form-label-sm">Situação inicial</label>
            <select id="novoStatus" class="form-select-dark w-100">
              <option value="ativo">Ativo</option>
              <option value="bloqueado">Bloqueado</option>
            </select>
          </div>
          <button type="submit" class="btn-salvar-barbeiro">
            <i class="bi bi-check2-circle"></i> Salvar barbeiro
          </button>
          <p class="helper-text">
            Em um sistema completo, esse cadastro já ligaria o barbeiro a um login próprio com permissões específicas.
          </p>
        </form>

      </section>

    </div>
  </main>
</div>

<!-- BOOTSTRAP JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

<script>
  const STORAGE_FINANCE_KEY = 'shaver_registros_financeiros';
  const STORAGE_BARBERS_KEY = 'shaver_barbers';

  const COMISSAO_PADRAO = 50; // % só para exibição

  // Referências DOM
  const labelMesAtual = document.getElementById('labelMesAtual');
  const labelMesAnterior = document.getElementById('labelMesAnterior');

  const kpiEntradaAtual = document.getElementById('kpiEntradaAtual');
  const kpiEntradaAnterior = document.getElementById('kpiEntradaAnterior');
  const kpiVariacao = document.getElementById('kpiVariacao');

  const linhaEntradas = document.getElementById('linhaEntradas');
  const linhaSaidas = document.getElementById('linhaSaidas');
  const linhaSaldo = document.getElementById('linhaSaldo');

  const tabelaRegistrosBody = document.getElementById('tabelaRegistrosBody');

  const listaBarbeiros = document.getElementById('listaBarbeiros');
  const formNovoBarbeiro = document.getElementById('formNovoBarbeiro');

  const inputNovoNome = document.getElementById('novoNome');
  const inputNovoApelido = document.getElementById('novoApelido');
  const inputNovaComissao = document.getElementById('novaComissao');
  const selectNovoStatus = document.getElementById('novoStatus');

  function formatarMoeda(valor) {
    return valor.toLocaleString('pt-BR', {
      style: 'currency',
      currency: 'BRL'
    });
  }

  function obterRegistrosFinanceiros() {
    try {
      const salvo = JSON.parse(localStorage.getItem(STORAGE_FINANCE_KEY) || '[]');
      return Array.isArray(salvo) ? salvo : [];
    } catch (e) {
      return [];
    }
  }

  function salvarBarbeiros(barbeiros) {
    localStorage.setItem(STORAGE_BARBERS_KEY, JSON.stringify(barbeiros));
  }

  function obterBarbeiros() {
    try {
      const salvo = JSON.parse(localStorage.getItem(STORAGE_BARBERS_KEY) || '[]');
      if (Array.isArray(salvo) && salvo.length > 0) {
        return salvo;
      }
    } catch (e) {}

    // Se não tiver nada salvo, cria lista padrão
    const padrao = [
      { id: 1, nome: 'João Santos', apelido: 'João', comissao: 50, status: 'ativo' },
      { id: 2, nome: 'Pedro Lima', apelido: 'Pedro', comissao: 50, status: 'ativo' },
      { id: 3, nome: 'Carlos Souza', apelido: 'Carlos', comissao: 50, status: 'ativo' },
      { id: 4, nome: 'Claudivan Junior', apelido: 'Claudivan', comissao: 50, status: 'ativo' }
    ];
    salvarBarbeiros(padrao);
    return padrao;
  }

  function obterChaveMes(date) {
    const ano = date.getFullYear();
    const mes = String(date.getMonth() + 1).padStart(2, '0');
    return ano + '-' + mes; // ex: 2025-12
  }

  function labelMes(ano, mes) {
    const nomes = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun',
                   'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
    return nomes[mes - 1] + '/' + ano;
  }

  function agruparPorMes(registros) {
    const grupos = {};
    for (let i = 0; i < registros.length; i++) {
      const r = registros[i];
      const data = r.pagoEm ? new Date(r.pagoEm) : new Date();
      const key = obterChaveMes(data);
      if (!grupos[key]) {
        grupos[key] = [];
      }
      grupos[key].push(r);
    }
    return grupos;
  }

  function somarMes(registrosMes) {
    let totalServicos = 0;
    let totalConsumos = 0;
    let total = 0;

    for (let i = 0; i < registrosMes.length; i++) {
      const r = registrosMes[i];
      totalServicos += Number(r.valorServicos || 0);
      totalConsumos += Number(r.valorConsumos || 0);
      total += Number(r.total || 0);
    }

    return { totalServicos, totalConsumos, total };
  }

  function atualizarPainelFinanceiro() {
    const registros = obterRegistrosFinanceiros();
    const grupos = agruparPorMes(registros);

    const hoje = new Date();
    const anoAtual = hoje.getFullYear();
    const mesAtualNum = hoje.getMonth() + 1;
    const chaveAtual = obterChaveMes(hoje);

    // mês anterior
    const dataAnterior = new Date(anoAtual, mesAtualNum - 2, 1); // JS: mês 0-based
    const chaveAnterior = obterChaveMes(dataAnterior);

    labelMesAtual.textContent = labelMes(anoAtual, mesAtualNum);
    labelMesAnterior.textContent = labelMes(dataAnterior.getFullYear(), dataAnterior.getMonth() + 1);

    const registrosAtual = grupos[chaveAtual] || [];
    const registrosAnterior = grupos[chaveAnterior] || [];

    const somaAtual = somarMes(registrosAtual);
    const somaAnterior = somarMes(registrosAnterior);

    const entradasAtual = somaAtual.total;
    const entradasAnterior = somaAnterior.total;

    // Saídas estimadas:
    // - repasse barbeiros: 50% de tudo
    // - custo produtos: 40% da parte de consumos
    const repasseBarbeiros = entradasAtual * 0.5;
    const custoProdutos = somaAtual.totalConsumos * 0.4;
    const saidas = repasseBarbeiros + custoProdutos;
    const saldo = entradasAtual - saidas;

    kpiEntradaAtual.textContent = formatarMoeda(entradasAtual);
    kpiEntradaAnterior.textContent = formatarMoeda(entradasAnterior);

    linhaEntradas.textContent = formatarMoeda(entradasAtual);
    linhaSaidas.textContent = formatarMoeda(saidas);
    linhaSaldo.textContent = formatarMoeda(saldo);

    if (entradasAnterior <= 0 && entradasAtual <= 0) {
      kpiVariacao.textContent = '--';
      kpiVariacao.className = 'kpi-variacao';
    } else if (entradasAnterior <= 0 && entradasAtual > 0) {
      kpiVariacao.textContent = '+100% (sem histórico anterior)';
      kpiVariacao.className = 'kpi-variacao up';
    } else {
      const diff = entradasAtual - entradasAnterior;
      const perc = (diff / entradasAnterior) * 100;
      const texto = (perc >= 0 ? '+' : '') + perc.toFixed(1) + '%';
      kpiVariacao.textContent = texto;
      kpiVariacao.className = 'kpi-variacao ' + (perc >= 0 ? 'up' : 'down');
    }

    // Preenche tabela com registros do mês atual
    tabelaRegistrosBody.innerHTML = '';
    if (registrosAtual.length === 0) {
      const tr = document.createElement('tr');
      const td = document.createElement('td');
      td.colSpan = 5;
      td.style.textAlign = 'center';
      td.style.fontSize = '0.78rem';
      td.style.color = '#9ca3af';
      td.textContent = 'Nenhum registro financeiro para o mês atual (simulação).';
      tr.appendChild(td);
      tabelaRegistrosBody.appendChild(tr);
    } else {
      for (let i = 0; i < registrosAtual.length; i++) {
        const r = registrosAtual[i];
        const tr = document.createElement('tr');

        const data = r.pagoEm ? new Date(r.pagoEm) : new Date();
        const dataStr = data.toLocaleDateString('pt-BR', {
          day: '2-digit',
          month: '2-digit'
        });

        const tdData = document.createElement('td');
        tdData.textContent = dataStr;

        const tdCliente = document.createElement('td');
        tdCliente.textContent = r.cliente || '-';

        const tdServ = document.createElement('td');
        tdServ.textContent = formatarMoeda(Number(r.valorServicos || 0));

        const tdCons = document.createElement('td');
        tdCons.textContent = formatarMoeda(Number(r.valorConsumos || 0));

        const tdTotal = document.createElement('td');
        tdTotal.textContent = formatarMoeda(Number(r.total || 0));

        tr.appendChild(tdData);
        tr.appendChild(tdCliente);
        tr.appendChild(tdServ);
        tr.appendChild(tdCons);
        tr.appendChild(tdTotal);

        tabelaRegistrosBody.appendChild(tr);
      }
    }
  }

  // ------- Gestão de barbeiros -------

  let barbeiros = obterBarbeiros();

  function renderizarBarbeiros() {
    listaBarbeiros.innerHTML = '';

    if (barbeiros.length === 0) {
      const div = document.createElement('div');
      div.style.fontSize = '0.8rem';
      div.style.color = '#9ca3af';
      div.textContent = 'Nenhum barbeiro cadastrado.';
      listaBarbeiros.appendChild(div);
      return;
    }

    for (let i = 0; i < barbeiros.length; i++) {
      const b = barbeiros[i];

      const item = document.createElement('div');
      item.classList.add('barbeiro-item');

      const info = document.createElement('div');
      info.classList.add('barbeiro-info');

      const nome = document.createElement('div');
      nome.classList.add('barbeiro-nome');
      nome.textContent = b.apelido + ' (' + b.nome + ')';

      const extra = document.createElement('div');
      extra.classList.add('barbeiro-extra');
      extra.textContent = 'Comissão: ' + (b.comissao || COMISSAO_PADRAO) + '%';

      info.appendChild(nome);
      info.appendChild(extra);

      const right = document.createElement('div');
      right.style.display = 'flex';
      right.style.alignItems = 'center';

      const status = document.createElement('span');
      status.classList.add('status-pill');
      if (b.status === 'ativo') {
        status.classList.add('status-ativo');
        status.textContent = 'Ativo';
      } else {
        status.classList.add('status-bloqueado');
        status.textContent = 'Bloqueado';
      }

      const btn = document.createElement('button');
      btn.type = 'button';
      btn.classList.add('btn-toggle');
      btn.dataset.id = b.id;

      if (b.status === 'ativo') {
        btn.classList.add('bloquear');
        btn.innerHTML = '<i class="bi bi-lock"></i> Bloquear';
      } else {
        btn.classList.add('ativar');
        btn.innerHTML = '<i class="bi bi-unlock"></i> Liberar';
      }

      btn.addEventListener('click', function () {
        toggleStatusBarbeiro(b.id);
      });

      right.appendChild(status);
      right.appendChild(btn);

      item.appendChild(info);
      item.appendChild(right);

      listaBarbeiros.appendChild(item);
    }
  }

  function toggleStatusBarbeiro(id) {
    for (let i = 0; i < barbeiros.length; i++) {
      if (barbeiros[i].id === id) {
        barbeiros[i].status = barbeiros[i].status === 'ativo' ? 'bloqueado' : 'ativo';
        break;
      }
    }
    salvarBarbeiros(barbeiros);
    renderizarBarbeiros();
  }

  if (formNovoBarbeiro) {
    formNovoBarbeiro.addEventListener('submit', function (e) {
      e.preventDefault();

      const nome = inputNovoNome.value.trim();
      const apelido = inputNovoApelido.value.trim();
      const comissao = Number(inputNovaComissao.value || COMISSAO_PADRAO);
      const status = selectNovoStatus.value || 'ativo';

      if (!nome || !apelido) {
        alert('Preencha nome e apelido do barbeiro.');
        return;
      }

      const novoId = barbeiros.length > 0 ? barbeiros[barbeiros.length - 1].id + 1 : 1;

      const novoBarbeiro = {
        id: novoId,
        nome: nome,
        apelido: apelido,
        comissao: comissao,
        status: status
      };

      barbeiros.push(novoBarbeiro);
      salvarBarbeiros(barbeiros);
      renderizarBarbeiros();

      formNovoBarbeiro.reset();
      inputNovaComissao.value = COMISSAO_PADRAO;
    });
  }

  // Inicialização
  atualizarPainelFinanceiro();
  renderizarBarbeiros();
</script>

</body>
</html>
